---
categories: 网络
---
## 三次握手

![三次握手|400](/res/img_net/三次握手.png)
>![TCP握手书上定义](/res/img_net/tcp握手书.png)
>
>开头两次握手都不携带数据，但都要消耗1个序号，
>
>为什么要三次握手？
>
>-  三次握手的过程即是通信双方相互告知序列号起始值， 并确认对方已经收到了序列号起始值的必经步骤。两次握手的话，只有请求方的序列号起始值能被确认
>
>  ![在这里插入图片描述](/res/img_net/tcp三次握手.png)

## 四次挥手

![四次挥手|400](/res/img_net/四次挥手.png)
>1. 客户端发送FIN，表示自己传完了
>
> 2. 服务端发送ACK，确认收到
>   - 服务端此时可进行数据传输
> 
>3. 服务端也传完了，发送FIN
>
> 4. 客户端发送ACK，确认收到
>   - 此时进入TIME-WAIT，时长为2MSL，MSL即报文段的最大生存时间，保证若自己的ACK发送失败，还能接收到服务端重发给自己的一次FIN。详细说就是第一个MSL是自己的ACK传过去，第二个是对方的FIN发过来。

## TCP的状态转换

>![|300](/res/img_net/TCP状态变化.png)
> TIME_WAIT=2MSL: 什么是MSL？为什么客户端最后还要等待2MSL？
>
> 什么是MSL
>
> - MSL是指TCP传输中，TCP报文段在网络中存在的最大生存时间。（MSL的主要目的是定义一个时间限制，以确保TCP报文段在网络中不会无限期地存在。是TCP允许不同的实现可以设置不同的MSL值）
>
> 为什么客户端最后还要等待2MSL
>
> - 确保对方收到最终ACK：TIME_WAIT状态确保连接的另一方（服务器）有足够的时间接收到最后一个ACK。因为如果服务器没有收到这个ACK，并且第三次挥手超时， 服务端可能认为它发送的第三次挥手失败（迷失在网络中）， 服务器它会重新发送FIN报文段（第三次挥手）。客户端在TIME_WAIT状态可以处理这种情况，确保连接的可靠终止。
> - 端口和资源的正确释放：这个等待期还允许操作系统正确地清理和释放用于连接的资源，如端口号。在2MSL结束后，相同的端口号可以安全地被新的连接使用，不会受到旧连接残留数据的影响。

## UDP

### UDP特点

> 1. **无连接**：UDP是一种无连接协议。这意味着在数据包发送之前，发送方和接收方之间不需要建立连接。每个数据包之间独立发送，彼此之间没有依赖关系。
> 2. **低开销**：UDP协议头部较小，只有8字节，相比之下，TCP协议头部最少20字节。UDP的简单性使得它在传输数据时增加的开销更少。
> 3. **不可靠传输**：UDP不提供数据到达的保证。因为它不进行错误检查或者纠正，意味着网络上的数据包可能会丢失、重复或乱序到达，且发送方不会得到通知。
> 4. **无拥塞控制**：UDP不实现拥塞控制机制。它以相同的速度发送数据，不论网络条件如何。这可能导致在网络质量较差时数据包被丢弃。
> 5. **快速传输**：由于缺乏连接建立、确认响应、流量控制等机制，UDP可以更快速地传输数据（能不能到目的地是另外一件事）。

## IP地址

### 分类

> ![](/res/img_net/IP分类.png)
>
> - A类地址：1.X.X.X~126.X.X.X 
>
>   - 网络号占用1字节 (网络号的字节构成位0XXX XXXX )
>
>   - 每一个网络下可以包含主机1677214台 (2^24 - 2) (24次方是因为主机号占用3字节, 主机号占用1字节)(-2是因为网络本身、广播IP)
>
> - B类地址：128.0.X.X~191.255.X.X
>
>   - 网络号占用2字节 (网络号的字节构成位10XX XXXX XXXX XXXX  )
>   - 每一个网络下可以包含主机65534台 (2^16 - 2) 
>
> - C类地址：192.0.0.X~223.255.255.X
>
>   - 网络号占用3字节 (网络号的字节构成位110X XXXX XXXX XXXX  )
>
>   -  每一个网络下可以包含主机254台 (2^8 - 2) 
>
> - D类地址：(224-239)是多播地址，主要用于多路广播用户, 非常用IP(D类地址没有划分为网络号和主机号)。
>
> - E类地址：(240-255)保留地址，目前尚未定义具体的用途。
>
> - 广播IP:   专门用于向该IP所在网络中所有IP主机进行发送广播数据行为的一个IP地址。广播地址的主机号全为1。 1.1.1.1
>
> - 网络本身IP: 用于标识该网络号的网络本身, 主机号全为0。 0.0.0.0
>
> - XXX.XXX.XXX.XXX的XXX是十进制，8位二进制表示,
>
>   最大十进制为2^8-1即255，所以比如XXX.XXX，能表示2^16个地址

## 子网掩码&CIDR

> - 子网掩码定义：32位二进制 由一串连续的1跟着一串连续的0组成，1的位数对应IP地址中的网络号和子网号.而0对应主机号
>
> ​         IP跟子网掩码相与，得到响应的网络地址
>
> - CIDR定义：无分类域间路由选择, 它在子网掩码的基础上消除了传统A、B、C类网络划分.
>
> ​        其实就是XXX.XXX.XXX.XXX/10的10；10代表前10位全是1：11111111.11000000.00000000.00000000


![|300](/res/img_net/网络报文.png)
----
